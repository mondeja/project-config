<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing third party plugins &mdash; project-config 0.3.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/bolditalic.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/override-styles.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing third party reporters" href="reporters.html" />
    <link rel="prev" title="Objects serialization" href="../in-depth/serialization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> project-config
          </a>
              <div class="version">
                0.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic-usage.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/cli.html">project-config CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/styling.html">Styling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/plugins.html">Plugins</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">In depth</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../in-depth/rationale.html">Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../in-depth/serialization.html">Objects serialization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing third party plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#plugin-class">Plugin class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-plugins">Testing plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reporters.html">Writing third party reporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/modules.html">Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">project-config</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Writing third party plugins</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/dev/plugins.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="writing-third-party-plugins">
<h1>Writing third party plugins<a class="headerlink" href="#writing-third-party-plugins" title="Permalink to this headline"></a></h1>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../reference/plugins.html"><span class="doc">Plugins</span></a></p>
</div>
<p><strong>project-config</strong> discover third party plugins from plugin entrypoints
looking for classes in the entrypoints group <code class="docutils literal notranslate"><span class="pre">project_config.plugins</span></code>,
so the first thing is to add the entrypoint to the group:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">poetry</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">setup.cfg</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">setup.py</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poetry.plugins.&quot;project_config.plugins&quot;]</span><span class="w"></span>
<span class="n">my_plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;package.subpackage.my_plugin_module:PluginClass&quot;</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[options.entry_points]</span><span class="w"></span>
<span class="na">project_config.plugins</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="na">my_plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">package.subpackage.my_plugin_module:PluginClass</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;project_config.plugins&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;my_plugin = package.subpackage.my_plugin_module:PluginClass&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div>
<p>The name of the entrypoint (<code class="docutils literal notranslate"><span class="pre">my_plugin</span></code> in the previous example)
is the name of the plugin, the one that must be defined in <a class="reference internal" href="../reference/styling.html#style-plugins"><span class="std std-ref">plugins (string[])</span></a>
if the style need it.</p>
<section id="plugin-class">
<h2>Plugin class<a class="headerlink" href="#plugin-class" title="Permalink to this headline"></a></h2>
<p>A valid plugin class must implement actions, which must be public static
methods. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">project_config</span> <span class="kn">import</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">Rule</span><span class="p">,</span> <span class="n">Results</span>

<span class="k">class</span> <span class="nc">PluginClass</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">verb</span><span class="p">(</span>  <span class="c1"># any public method that do not start with &#39;if&#39; is a verb</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">,</span>
        <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">ifConditional</span><span class="p">(</span>  <span class="c1"># a conditional starts with &#39;if&#39;</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">,</span>
        <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="action">
<span class="sig-name descname"><span class="pre">action</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="reference/project_config.tree.html#project_config.tree.Tree" title="project_config.tree.Tree"><span class="pre">project_config.tree.Tree</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rule</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="reference/project_config.types.html#project_config.types.Rule" title="project_config.types.Rule"><span class="pre">project_config.types.Rule</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">project_config.types.Results</span></span></span><a class="headerlink" href="#action" title="Permalink to this definition"></a></dt>
<dd><p>Action definition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.10)"><em>Any</em></a>) – Value that takes the action. It could be of any type, it depends to the action.</p></li>
<li><p><strong>tree</strong> (<a class="reference internal" href="reference/project_config.tree.html#project_config.tree.Tree" title="project_config.tree.Tree"><code class="xref py py-class docutils literal notranslate"><span class="pre">project_config.tree.Tree</span></code></a>) – Tree of files and directories that takes the action in the <code class="docutils literal notranslate"><span class="pre">files</span></code> property of the rule.</p></li>
<li><p><strong>rule</strong> (<a class="reference internal" href="reference/project_config.types.html#project_config.types.Rule" title="project_config.types.Rule"><code class="xref py py-class docutils literal notranslate"><span class="pre">project_config.types.Rule</span></code></a>) – Complete rule dictionary in which the action is being executed.</p></li>
</ul>
</dd>
<dt class="field-even">Yield</dt>
<dd class="field-even"><p>Checking results.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">project_config.types.Results</span></code></p>
</dd>
</dl>
</dd></dl>

<section id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this headline"></a></h3>
<p>Each action must yield results, which are tuples of two items,
defined next as <cite>result type</cite> - <cite>result value</cite>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Error</span></code> - Checking error, a dictionary (optionally but recommendably typed as <a class="reference internal" href="reference/project_config.types.html#project_config.types.ErrorDict" title="project_config.types.ErrorDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">project_config.types.ErrorDict</span></code></a>) which must contains the required keys <code class="docutils literal notranslate"><span class="pre">message</span></code> (error message shown in the report) and <code class="docutils literal notranslate"><span class="pre">definition</span></code> (definition in which the error has been thrown) and an optional key <code class="docutils literal notranslate"><span class="pre">file</span></code> (file for which the error has been thrown). If raised from conditionals their behaviour is the same that raising an <code class="docutils literal notranslate"><span class="pre">InterruptingError</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InterruptingError</span></code> - The same as a checking error, but this type of error will stop the execution of the subsequent rules during the checking. Useful if the user has passed some unexpected value that could lead to an invalid context in some later rule.</p></li>
</ul>
<p>Additionally, conditionals can yield result values, which
define if the verbs of the rule should be executed or not.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ResultValue</span></code> - A boolean. When a conditional yields it, the execution of the conditional is terminated and, if the yielded value is <code class="docutils literal notranslate"><span class="pre">False</span></code>, the execution of the verbs of the rule are skipped. If no result values are yielded by a conditional, the verbs of the rule are always executed as if the conditional would returned <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
</ul>
<p>You must import these variables from <code class="docutils literal notranslate"><span class="pre">project_config</span></code> because their
values can change between versions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">project_config</span> <span class="kn">import</span> <span class="n">Error</span><span class="p">,</span> <span class="n">InterruptingError</span><span class="p">,</span> <span class="n">ResultValue</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The best way to learn the most common patterns to write plugins
is checking the source code of the simplest built-in plugins:</p>
<ul class="simple">
<li><p><a class="reference internal" href="reference/project_config.plugins.include.html#project_config.plugins.include.IncludePlugin" title="project_config.plugins.include.IncludePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">project_config.plugins.include.IncludePlugin</span></code></a></p></li>
<li><p><a class="reference internal" href="reference/project_config.plugins.jmespath.html#project_config.plugins.jmespath.JMESPathPlugin" title="project_config.plugins.jmespath.JMESPathPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">project_config.plugins.jmespath.JMESPathPlugin</span></code></a></p></li>
</ul>
</div>
</section>
</section>
<section id="testing-plugins">
<h2>Testing plugins<a class="headerlink" href="#testing-plugins" title="Permalink to this headline"></a></h2>
<p><strong>project-config</strong> comes with a built-in <a class="reference external" href="https://docs.pytest.org/en/latest/explanation/fixtures.html">pytest fixture</a> to
easily test plugin actions. See
<a class="reference internal" href="reference/project_config.tests.pytest_plugin.plugin.html#module-project_config.tests.pytest_plugin.plugin" title="project_config.tests.pytest_plugin.plugin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">project_config.tests.pytest_plugin.plugin</span></code></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../in-depth/serialization.html" class="btn btn-neutral float-left" title="Objects serialization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reporters.html" class="btn btn-neutral float-right" title="Writing third party reporters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Álvaro Mondéjar Rubio.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>